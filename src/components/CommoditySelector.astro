---
// src/components/CommoditySelector.astro
import BodyCopyImage from './BodyCopyImage.astro';

export interface HighlightLink {
  text: string;
  href: string;
}

export interface SelectorItem {
  id: string;
  tabText: string; // Text for the thumbnail/tab
  // Content content
  title: string;
  description: string;
  imageUrl: string;
  imageAlt?: string;
  buttonText?: string;
  buttonHref?: string;
  highlightLinks?: HighlightLink[];
}

export interface Props {
  title?: string;
  items: SelectorItem[];
  id?: string;
}

const { 
  title = "Commodities coverage", 
  items,
  id = "commodity-selector-" + Math.random().toString(36).substr(2, 9)
} = Astro.props;
---

<div class="commodity-selector-block no-margin-upper no-margin-lower" id={id}>
    <div class="wrap">
        {title && (
            <div class="commodity-selector-block__title-container">
                <h3 class="commodity-selector-block__title_center">
                    {title}
                </h3>
            </div>
        )}

        <div class="carousel swiper swiper-thumbs white-bg-controls commodity-selector-swiper-thumbs">
            <div class="swiper-control-left">
                <div class="swiper-button-left"></div>
            </div>
            <div class="swiper-wrapper">
                {items.map((item) => (
                    <div class="carousel__slide swiper-slide commodity-selector-block__thumbnail" data-item-id={item.id}>
                        <div class="commodity-selector-block__thumb-text">
                            {item.tabText}
                        </div>
                        <div class="commodity-selector-block__thumb-active-border"></div>
                    </div>
                ))}
            </div>
            <div class="swiper-control-right">
                <div class="swiper-button-right"></div>
            </div>
        </div>

        <div class="carousel swiper swiper-content white-bg-controls commodity-selector-swiper-content">
            <div class="swiper-wrapper">
                {items.map((item) => (
                    <div class="carousel__slide swiper-slide" data-item-id={item.id}>
                        <BodyCopyImage
                            title={item.title}
                            description={item.description}
                            buttonText={item.buttonText || ""}
                            buttonHref={item.buttonHref || ""}
                            imageUrl={item.imageUrl}
                            imageAlt={item.imageAlt || item.title}
                            reverseLayout={true} 
                        >
                            {item.highlightLinks && item.highlightLinks.length > 0 && (
                                <div class="body-copy-image__highlight-link-box" slot="after-description">
                                    <h4 class="body-copy-image__highlight-link-box--header">Available in Lens</h4>
                                    <ul class="body-copy-image__highlight-link-box--linklist">
                                        {item.highlightLinks.map(link => (
                                            <li>
                                                <a class="body-copy-image__highlight-link-box--linkitem" href={link.href}>
                                                    <p>{link.text}</p>
                                                </a>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            )}
                        </BodyCopyImage>
                    </div>
                ))}
            </div>
        </div>
    </div>
</div>

<script define:vars={{ id }}>
  import Swiper from 'swiper';
  import { Navigation, Thumbs } from 'swiper/modules';
  
  import 'swiper/css';
  import 'swiper/css/navigation';
  import 'swiper/css/thumbs';
  
  document.addEventListener('DOMContentLoaded', () => {
    const selectorBlock = document.getElementById(id);
    if (!selectorBlock) return;

    const thumbsContainer = selectorBlock.querySelector('.commodity-selector-swiper-thumbs');
    const contentContainer = selectorBlock.querySelector('.commodity-selector-swiper-content');
    const nextBtn = selectorBlock.querySelector('.swiper-button-right');
    const prevBtn = selectorBlock.querySelector('.swiper-button-left');

    // Ensure elements exist
    if (!thumbsContainer || !contentContainer) return;

    const thumbsSwiper = new Swiper(thumbsContainer, {
      modules: [Navigation, Thumbs],
      spaceBetween: 10,
      slidesPerView: 'auto',
      freeMode: true,
      watchSlidesProgress: true,
      navigation: {
        nextEl: nextBtn,
        prevEl: prevBtn,
      },
      breakpoints: {
        768: {
          slidesPerView: 4, 
        },
        1024: {
          slidesPerView: 6,
        },
      },
    });

    const contentSwiper = new Swiper(contentContainer, {
      modules: [Navigation, Thumbs],
      spaceBetween: 36,
      slidesPerView: 1,
      thumbs: {
        swiper: thumbsSwiper,
      },
    });
  });
</script>

<style>
.swiper-button-left, .swiper-button-right {
    cursor: pointer;
}
</style>