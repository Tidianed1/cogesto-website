---
// src/components/CommoditySelector.astro
import { type CollectionEntry } from 'astro:content';
import BodyCopyImage from './BodyCopyImage.astro';

export interface HighlightLink {
  text: string;
  href: string;
}

export interface CommodityContent {
  preTitle?: string;
  title: string;
  description: string;
  buttonText?: string;
  buttonHref?: string;
  imageUrl: string;
  imageAlt: string;
  reverseLayout?: boolean;
  highlightLinks?: HighlightLink[];
}

export interface Commodity {
  id: string;
  thumbTitle: string;
  content: CommodityContent;
}

export interface Props {
  title: string;
  commodities: Commodity[];
}

const { title, commodities } = Astro.props;
---

<div class="commodity-selector-block no-margin-upper no-margin-lower" id="commodity-selector">
    <div class="wrap">
        <div class="commodity-selector-block__title-container">
            <h3 class="commodity-selector-block__title_center">
                {title}
            </h3>
        </div>

        <div class="carousel swiper-container swiper-thumbs white-bg-controls commodity-selector-swiper-thumbs-0">
            <div class="swiper-control-left">
                <div class="swiper-button-left"></div>
            </div>
            <div class="swiper-wrapper">
                {commodities.map((commodity) => (
                    <div class="carousel__slide swiper-slide commodity-selector-block__thumbnail" data-commodity-id={commodity.id}>
                        <div class="commodity-selector-block__thumb-text">
                            {commodity.thumbTitle}
                        </div>
                        <div class="commodity-selector-block__thumb-active-border"></div>
                    </div>
                ))}
            </div>
            <div class="swiper-control-right">
                <div class="swiper-button-right"></div>
            </div>
        </div>

        <div class="carousel swiper-container swiper-content white-bg-controls commodity-selector-swiper-content-0">
            <div class="swiper-wrapper">
                {commodities.map((commodity) => (
                    <div class="carousel__slide swiper-slide" data-commodity-id={commodity.id}>
                        <BodyCopyImage
                            preTitle={commodity.content.preTitle}
                            title={commodity.content.title}
                            description={commodity.content.description}
                            buttonText={commodity.content.buttonText}
                            buttonHref={commodity.content.buttonHref}
                            imageUrl={commodity.content.imageUrl}
                            imageAlt={commodity.content.imageAlt}
                            reverseLayout={commodity.content.reverseLayout}
                        >
                            {commodity.content.highlightLinks && commodity.content.highlightLinks.length > 0 && (
                                <div class="body-copy-image__highlight-link-box" slot="after-description">
                                    <h4 class="body-copy-image__highlight-link-box--header">Now available in Lens Metals &amp; Mining</h4>
                                    <ul class="body-copy-image__highlight-link-box--linklist">
                                        {commodity.content.highlightLinks.map(link => (
                                            <li>
                                                <a class="body-copy-image__highlight-link-box--linkitem" href={link.href}>
                                                    <p class="">{link.text}</p>
                                                </a>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            )}
                        </BodyCopyImage>
                    </div>
                ))}
            </div>
        </div>
    </div>
</div>

<script>
  import Swiper from 'swiper';
  import { Navigation, Thumbs } from 'swiper/modules';
  import 'swiper/css';
  import 'swiper/css/navigation';
  import 'swiper/css/thumbs';

  document.addEventListener('DOMContentLoaded', () => {
    const commoditySelectorBlock = document.getElementById('commodity-selector');
    if (!commoditySelectorBlock) return;

    const thumbsSwiper = new Swiper(commoditySelectorBlock.querySelector('.commodity-selector-swiper-thumbs-0'), {
      modules: [Navigation, Thumbs],
      spaceBetween: 10,
      slidesPerView: 'auto',
      freeMode: true,
      watchSlidesProgress: true,
      navigation: {
        nextEl: commoditySelectorBlock.querySelector('.swiper-button-right'),
        prevEl: commoditySelectorBlock.querySelector('.swiper-button-left'),
      },
      breakpoints: {
        768: {
          slidesPerView: 6,
        },
        1024: {
          slidesPerView: 8,
        },
      },
    });

    new Swiper(commoditySelectorBlock.querySelector('.commodity-selector-swiper-content-0'), {
      modules: [Navigation, Thumbs],
      spaceBetween: 36,
      slidesPerView: 1,
      navigation: {
        nextEl: commoditySelectorBlock.querySelector('.swiper-button-right'),
        prevEl: commoditySelectorBlock.querySelector('.swiper-button-left'),
      },
      thumbs: {
        swiper: thumbsSwiper,
      },
    });
  });
</script>
