---
// BlogArticleShowcase.astro
// Renders a featured article layout with one large "highlighted" article on the left
// and a column of secondary articles on the right.
// STRICTLY ADHERES to Cogesto Design System (DESIGN_SYSTEM.md).

export interface ArticleItem {
  title: string;
  excerpt?: string;
  href: string;
  imageSrc: string;
  imageAlt?: string;
  format?: string; // e.g., "Podcast", "Article"
  date?: string;
  badge?: string; // Used for filtering/display
}

export interface TabItem {
  id: string;
  label: string;
}

export interface Props {
  title?: string;
  subtitle?: string;
  highlightedArticle: ArticleItem;
  secondaryArticles: ArticleItem[];
  tabs?: TabItem[];
  seeMoreLink?: string;
  seeMoreText?: string;
  id?: string;
}

const {
  title = "Nos articles r√©cents",
  subtitle = "Plongez dans nos insights",
  highlightedArticle = {} as ArticleItem,
  secondaryArticles = [],
  tabs = [],
  seeMoreLink,
  seeMoreText = "Voir plus de contenus",
  id = "content-home"
} = Astro.props;

if (!highlightedArticle || !highlightedArticle.title) {
  return null; 
}
---

<section id={id} class="module soft-double--ends bg-white">
    <div class="wrap">
        
        <!-- Section Header with Tabs -->
        <div class="col small-12 push-bottom--double flexbox justify-between align-end flex-wrap">
            <div>
                <div class="trait push-half--bottom"></div>
                <h2 class="h200 core-branding-rich-blue">
                    <span class="font-light d-block">{title}</span>
                    <span class="font-bold">{subtitle}</span>
                </h2>
            </div>
            
            {tabs.length > 0 && (
                <div class="tabs-container push-top--small">
                    {tabs.map(tab => (
                        <button class="btn--tab gamma font-bold core-branding-rich-blue soft-half--sides" data-target={tab.id}>
                            {tab.label}
                        </button>
                    ))}
                </div>
            )}
        </div>

        <div class="row">
            <!-- Left Column: Highlighted Article -->
            <div class="col small-12 medium-6 large-7 push-bottom--double">
                <article class="highlighted-article h-full flexbox direction-column" data-category={highlightedArticle.badge?.toLowerCase()}>
                    <a href={highlightedArticle.href} class="block-link relative img-overlay push--bottom" aria-label={highlightedArticle.title}>
                        <div class="img-overlay__wrap ratio-16x9">
                            <img 
                                src={highlightedArticle.imageSrc} 
                                class="img-overlay__image w-full" 
                                alt={highlightedArticle.imageAlt || ""} 
                                loading="lazy"
                            />
                        </div>
                    </a>
                    <div class="article-content flex-1 flexbox direction-column">
                        {highlightedArticle.format && (
                            <div class="meta gamma font-bold uppercase tracking text-secondary push-quarter--bottom">
                                {highlightedArticle.format}
                            </div>
                        )}
                        <h3 class="alpha font-bold core-branding-rich-blue push-half--bottom">
                            <a href={highlightedArticle.href} class="dark-link">{highlightedArticle.title}</a>
                        </h3>
                        {highlightedArticle.excerpt && (
                            <div class="body-copy beta dark-grey-1 push--bottom flex-1">
                                <p>{highlightedArticle.excerpt}</p>
                            </div>
                        )}
                        <div class="push-top--auto">
                            <a href={highlightedArticle.href} class="link icon--right info-style font-bold">
                                En savoir plus
                            </a>
                        </div>
                    </div>
                </article>
            </div>

            <!-- Right Column: Secondary Articles List -->
            <div class="col small-12 medium-6 large-5">
                <div class="secondary-articles-list">
                    {secondaryArticles.map((article) => (
                        <article class="secondary-article flexbox align-start push-bottom--double" data-category={article.badge?.toLowerCase()}>
                            <a href={article.href} class="block-link relative img-overlay shrink-0" style="width: 35%; margin-right: 1.5rem;" aria-label={article.title}>
                                <div class="img-overlay__wrap ratio-16x9">
                                    <img 
                                        src={article.imageSrc} 
                                        class="img-overlay__image w-full" 
                                        alt={article.imageAlt || ""} 
                                        loading="lazy"
                                    />
                                </div>
                            </a>
                            <div class="article-content flex-1">
                                {article.format && (
                                    <div class="meta delta font-bold uppercase tracking text-secondary push-quarter--bottom">
                                        {article.format}
                                    </div>
                                )}
                                <h3 class="gamma font-bold core-branding-rich-blue push-half--bottom line-clamp-2">
                                    <a href={article.href} class="dark-link">{article.title}</a>
                                </h3>
                                <a href={article.href} class="link icon--right info-style font-bold delta">
                                    En savoir plus
                                </a>
                            </div>
                        </article>
                    ))}
                </div>
            </div>
        </div>

        {seeMoreLink && (
            <div class="col small-12 text-center push-top--double">
                <a href={seeMoreLink} class="btn btn--secondary">
                    {seeMoreText}
                </a>
            </div>
        )}
    </div>
</section>

<style>
    .trait {
        width: 60px;
        height: 4px;
        background-color: #0024ff;
    }

    .d-block { display: block; }

    .ratio-16x9 {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%;
        overflow: hidden;
        background-color: #f7f7f7;
    }

    .ratio-16x9 img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .text-secondary { color: #0024ff; }
    .dark-link:hover { color: #0024ff; text-decoration: none; }

    /* Tab Styles */
    .btn--tab {
        background: none;
        border: none;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: all 0.3s ease;
        opacity: 0.7;
    }
    .btn--tab:hover, .btn--tab.active {
        opacity: 1;
        border-bottom-color: #0024ff;
    }
    .tabs-container {
        display: flex;
        gap: 1rem;
    }
</style>
