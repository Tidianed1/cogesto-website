---
// BlogArticleShowcase.astro
// Renders a featured article layout with one large "highlighted" article on the left
// and a column of secondary articles on the right.
// STRICTLY ADHERES to Cogesto Design System (DESIGN_SYSTEM.md).

export interface ArticleItem {
  title: string;
  excerpt?: string;
  href: string;
  imageSrc: string;
  imageAlt?: string;
  format?: string; // e.g., "Podcast", "Article"
  date?: string;
}

export interface Props {
  title?: string;
  subtitle?: string;
  highlightedArticle: ArticleItem;
  secondaryArticles: ArticleItem[];
  seeMoreLink?: string;
  seeMoreText?: string;
  id?: string;
}

const {
  title = "Nos articles r√©cents",
  subtitle = "Plongez dans nos insights",
  highlightedArticle = {} as ArticleItem,
  secondaryArticles = [],
  seeMoreLink,
  seeMoreText = "Voir plus de contenus",
  id = "content-home"
} = Astro.props;

// Safety check: if no highlighted article, return minimal or nothing to prevent crash
if (!highlightedArticle || !highlightedArticle.title) {
  return null; 
}
---

<section id={id} class="module soft-double--ends bg-white">
    <div class="wrap">
        
        <!-- Section Header -->
        <div class="col small-12 push-bottom--double">
            <div class="trait push-half--bottom"></div>
            <h2 class="h200 core-branding-rich-blue">
                <span class="font-light d-block">{title}</span>
                <span class="font-bold">{subtitle}</span>
            </h2>
        </div>

        <div class="row">
            <!-- Left Column: Highlighted Article -->
            <div class="col small-12 medium-6 large-7 push-bottom--double">
                <article class="highlighted-article h-full flexbox direction-column">
                    <a href={highlightedArticle.href} class="block-link relative img-overlay push--bottom" aria-label={highlightedArticle.title}>
                        <div class="img-overlay__wrap ratio-16x9">
                            <img 
                                src={highlightedArticle.imageSrc} 
                                class="img-overlay__image w-full" 
                                alt={highlightedArticle.imageAlt || ""} 
                                loading="lazy"
                            />
                            {highlightedArticle.format === 'Podcast' && (
                                <div class="overlay-play-icon">
                                    <img src="/img/icons/play.svg" alt="Play" width="48" height="48" />
                                </div>
                            )}
                        </div>
                    </a>
                    <div class="article-content flex-1 flexbox direction-column">
                        {highlightedArticle.format && (
                            <div class="meta gamma font-bold uppercase tracking text-secondary push-quarter--bottom">
                                {highlightedArticle.format}
                            </div>
                        )}
                        <h3 class="alpha font-bold core-branding-rich-blue push-half--bottom">
                            <a href={highlightedArticle.href} class="dark-link">{highlightedArticle.title}</a>
                        </h3>
                        {highlightedArticle.excerpt && (
                            <div class="body-copy beta dark-grey-1 push--bottom flex-1">
                                <p>{highlightedArticle.excerpt}</p>
                            </div>
                        )}
                        <div class="push-top--auto">
                            <a href={highlightedArticle.href} class="link icon--right info-style font-bold">
                                En savoir plus
                            </a>
                        </div>
                    </div>
                </article>
            </div>

            <!-- Right Column: Secondary Articles List -->
            <div class="col small-12 medium-6 large-5">
                <div class="secondary-articles-list">
                    {secondaryArticles.map((article) => (
                        <article class="secondary-article flexbox align-start push-bottom--double">
                            <a href={article.href} class="block-link relative img-overlay shrink-0" style="width: 35%; margin-right: 1.5rem;" aria-label={article.title}>
                                <div class="img-overlay__wrap ratio-16x9">
                                    <img 
                                        src={article.imageSrc} 
                                        class="img-overlay__image w-full" 
                                        alt={article.imageAlt || ""} 
                                        loading="lazy"
                                    />
                                    {article.format === 'Podcast' && (
                                        <div class="overlay-play-icon small">
                                            <img src="/img/icons/play.svg" alt="Play" width="32" height="32" />
                                        </div>
                                    )}
                                </div>
                            </a>
                            <div class="article-content flex-1">
                                {article.format && (
                                    <div class="meta delta font-bold uppercase tracking text-secondary push-quarter--bottom">
                                        {article.format}
                                    </div>
                                )}
                                <h3 class="gamma font-bold core-branding-rich-blue push-half--bottom line-clamp-2">
                                    <a href={article.href} class="dark-link">{article.title}</a>
                                </h3>
                                <a href={article.href} class="link icon--right info-style font-bold delta">
                                    En savoir plus
                                </a>
                            </div>
                        </article>
                    ))}
                </div>
            </div>
        </div>

        {seeMoreLink && (
            <div class="col small-12 text-center push-top--double">
                <a href={seeMoreLink} class="btn btn--secondary">
                    {seeMoreText}
                </a>
            </div>
        )}
    </div>
</section>

<style>
    /* Custom utilities not fully covered by global CSS */
    
    .trait {
        width: 60px;
        height: 4px;
        background-color: #0024ff; /* Secondary color/Cobalt */
    }

    .d-block {
        display: block;
    }

    .ratio-16x9 {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%; /* 16:9 aspect ratio */
        overflow: hidden;
        background-color: #f7f7f7;
    }

    .ratio-16x9 img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .overlay-play-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.3);
        border-radius: 50%;
        padding: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s ease;
    }
    
    .overlay-play-icon.small {
        padding: 0.5rem;
    }

    .block-link:hover .overlay-play-icon {
        background: rgba(0, 0, 0, 0.5);
    }

    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* Ensure text colors match design system variable names if not global */
    .text-secondary {
        color: #0024ff;
    }
    
    .dark-link:hover {
        color: #0024ff;
        text-decoration: none;
    }
</style>