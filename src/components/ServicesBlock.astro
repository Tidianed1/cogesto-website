---
import { randomUUID } from 'crypto';

export interface ServiceItem {
  iconSrc: string;
  title: string;
  description: string;
  ctaText: string;
  ctaHref: string;
  ga4Tracking: string;
}

export interface Props {
  title: string;
  services: ServiceItem[];
}

const { title, services } = Astro.props;

// Augment services with unique IDs for accordion controls
const servicesWithIds = services.map(service => ({
  ...service,
  accordionId: randomUUID(),
}));
---

<div class="services-block" id="services-block">
  <div class="wrap">
    <div class="wrap services-block__summary">
      <div class="services-block__title-container col small-12 large-6 soft--double-right--large">
        <h2 class="peta services-block__title">
          {title}
        </h2>
      </div>
    </div>
    <div class="wrap">
      <!-- Desktop: Card Grid -->
      <div class="services-card-container services-card-container-grid show-for-medium-up">
        {servicesWithIds.map(service => (
          <div class="services-card">
            <img class="push--bottom services-card__icon" src={service.iconSrc} alt="" width="40" height="40" />
            <div class="services-card__copy">
              <div class="services-card__title">
                <h3 class="kilo">{service.title}</h3>
              </div>
              <p>{service.description}</p>
            </div>
            <div class="services-card__cta">
              <span class="services-card__link gamma">
                {service.ctaText}
                <img src="/img/icons/icon-arrow--dark-blue.svg" alt="arrow" class="ml-2 inline-block" />
              </span>
            </div>
            <a href={service.ctaHref} ga4-component-tracking={service.ga4Tracking}></a>
          </div>
        ))}
      </div>

      <!-- Mobile: Accordion -->
      <div class="services-accordion-container show-for-small-only">
        <div class="c-accordionblock__wrapper relative push--bottom">
          <div class="c-accordionblock__acordion__section">
            <div class="services-accordionblock__inner">
              <div class="col js-accordion services-block__accordion-mobile">
                {servicesWithIds.map(service => (
                  <div class="services-accordion__wrapper">
                    <div class="services-accordion__item-title">
                      <img class="services-accordion__icon" src={service.iconSrc} alt="" width="40" height="40" />
                      <h3 class="small-12">
                        <button
                          aria-expanded="false"
                          class="services-accordionblock__trigger js-accordion__trigger services-accordionblock__item__title"
                          aria-controls={`accordion-section-${service.accordionId}`}
                          id={`accordion-button-${service.accordionId}`}
                        >
                          {service.title}
                        </button>
                      </h3>
                    </div>
                    <div
                      class="c-accordion__panel"
                      id={`accordion-section-${service.accordionId}`}
                      role="region"
                      aria-labelledby={`accordion-button-${service.accordionId}`}
                    >
                      <div class="c-accordionblock__item">
                        {service.description}
                      </div>
                      <div class="services-accordion__cta">
                        <a
                          class="services-accordion__link"
                          href={service.ctaHref}
                          ga4-component-tracking={service.ga4Tracking}
                        >
                          {service.ctaText}
                          <img src="/img/icons/icon-arrow--dark-blue.svg" alt="arrow" class="ml-2 inline-block" />
                        </a>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
