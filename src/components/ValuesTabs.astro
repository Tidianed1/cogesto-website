---
// Values tabs component - matches tabbed__block structure from reference
export interface TabItem {
  id: string;
  title: string;
  content: string;
  active?: boolean;
}

export interface Props {
  summaryTitle: string;
  summaryDescription: string;
  tabs: TabItem[];
}

const { summaryTitle, summaryDescription, tabs } = Astro.props;

// Determine the initially active tab
const initialActiveTabId = tabs.find(tab => tab.active)?.id || tabs[0]?.id;
---

<div class="tabbed__block" id="tabbed-component">
    <div class="wrap">
        <div class="tabbed__block-container small-12">
            <div class="tabbed__summary col small-12 medium-4">
                <h3 class="tabbed__summary-title h300">
                    {summaryTitle}
                </h3>
                <p class="tabbed__summary-description" set:html={summaryDescription}></p>
            </div>
            <div class="tabbed__tabs col small-12 medium-8">
                <div class="tabbed__tabs-list">
                    {tabs.map((tab) => (
                        <a
                            class:list={["tabbed__tabs-list-item", { "active": tab.id === initialActiveTabId }]}
                            data-target={tab.id}
                            role="tab"
                            tabindex="0"
                            ga4-component-tracking={`{"event":"component_click","type":"Tabbed Component Tab Click","title":"${tab.title}"}`}
                        >
                            {tab.title}
                        </a>
                    ))}
                </div>
                <!-- DROPDOWN -->
                <div class="tabbed__tabs-dropdown">
                    <select class="form-select" data-val="true" data-val-required="The Tabbed Sections field is required." id="tabDropdown" name="CurrentPage.Body.TabbedComponentContent">
                        {tabs.map((tab) => (
                            <option value={tab.id} selected={tab.id === initialActiveTabId}>
                                {tab.title}
                            </option>
                        ))}
                    </select>
                </div>

                <div class="tabbed__content">
                    {tabs.map((tab) => (
                        <div
                            id={tab.id}
                            class:list={["tabbed__content-container", { "active": tab.id === initialActiveTabId }]}
                            role="tabpanel"
                        >
                            <div class="editor" set:html={tab.content}></div>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    </div>
</div>

<script is:inline>
  (function() {
    function initTabbedComponent() {
      const tabbedBlock = document.getElementById('tabbed-component');
      if (!tabbedBlock) return;

      const tabLinks = tabbedBlock.querySelectorAll('.tabbed__tabs-list-item');
      const tabContents = tabbedBlock.querySelectorAll('.tabbed__content-container');
      const tabDropdown = tabbedBlock.querySelector('#tabDropdown');

      function activateTab(targetId) {
        // Deactivate all links and content
        tabLinks.forEach(link => link.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));

        // Activate the selected link
        const activeLink = tabbedBlock.querySelector(`.tabbed__tabs-list-item[data-target="${targetId}"]`);
        if (activeLink) {
          activeLink.classList.add('active');
        }

        // Activate the selected content
        const activeContent = tabbedBlock.querySelector(`#${targetId}`);
        if (activeContent) {
          activeContent.classList.add('active');
        }

        // Update dropdown selection
        if (tabDropdown) {
          tabDropdown.value = targetId;
        }
      }

      // Event listener for tab links
      tabLinks.forEach(link => {
        link.addEventListener('click', function(event) {
          event.preventDefault();
          const targetId = this.getAttribute('data-target');
          activateTab(targetId);
        });
      });

      // Event listener for dropdown
      if (tabDropdown) {
        tabDropdown.addEventListener('change', function() {
          const targetId = this.value;
          activateTab(targetId);
        });
      }

      // Set initial active tab based on props (handled by Astro class:list)
      // If no active tab is set in props, default to the first one
      const initiallyActiveLink = tabbedBlock.querySelector('.tabbed__tabs-list-item.active');
      if (!initiallyActiveLink && tabLinks.length > 0) {
        activateTab(tabLinks[0].getAttribute('data-target'));
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initTabbedComponent);
    } else {
      initTabbedComponent();
    }
  })();
</script>
